-- > Locals
local plr = game.Players.LocalPlayer
local die = false

-- > Functions
function tp(cframe)
    plr.Character.HumanoidRootPart.CFrame = cframe
end

function kill(mob)
    local count = 0
    repeat
        game:GetService("RunService").Heartbeat:Wait()
        tp(mob.HumanoidRootPart.CFrame + Vector3.new(0,13,0))
        plr.Backpack.Input:FireServer("m1")
        count = count + 0.1
    until mob.Health.Value == 0 or die or count > 25
    if count > 40 then
        print("[Script] Skipped")
    end
    if die then
        repeat
            wait()
        until die == false
    end
end

coroutine.wrap(function()
    while wait() do
        if plr.Character.Humanoid.Health < 1 then
            die = true
        else
            die = false
        end
        if plr.Character.Humanoid.Health < 100 then
            for i,v in next, game:GetService("Workspace").Touch:GetChildren() do
                if string.find(v.Name, "Heart") then
                    tp(v.CFrame)
                    wait()
                end
            end
        end
    end
end)()

-- > Script
while wait() do

    wait(3)

    local nowFloor = plr.PlayerGui.HUD.Floor.Text

    for i,v in next, game:GetService("Workspace").Events:GetChildren() do
        if v.Prompt.Value == "Praise Statue" then
            tp(v.CFrame)
            wait(.5)
            plr.Backpack.Input:FireServer("event", v)
        end
    end

    for i,v in next, game:GetService("Workspace").Enemy:GetChildren() do
        kill(v)
    end

    for i,v in next, game:GetService("Workspace").Chest:GetChildren() do
        tp(v.Touch.CFrame - Vector3.new(0,1,0))
        wait(1.5)
        plr.Backpack.Input:FireServer("f")
    end

    for i,v in next, game:GetService("Workspace").Touch:GetChildren() do
        tp(v.CFrame)
        wait()
    end

    for i,v in next, game:GetService("Workspace").Items:GetChildren() do
        if v:FindFirstChild("Cost") == nil and v:FindFirstChild("HeartCost") == nil then
            tp(v.CFrame)
            wait(0.3)
            plr.Backpack.Input:FireServer("f")
        end
    end

    for i,v in next, game:GetService("Workspace").Events:GetChildren() do
        if v.Prompt.Value == "Bank Gold" then
            tp(v.CFrame)
            wait(.5)
            plr.Backpack.Input:FireServer("event", v)
        end
    end

    if getgenv().autoTpStairs then
        tp(game.Workspace.Dungeon.Stairs.Touch.CFrame)  
    end

    -- > Detect Teleported To Next Floor
    repeat
        wait()
    until (nowFloor ~= plr.PlayerGui.HUD.Floor.Text and game.Workspace.Dungeon:FindFirstChild("Stairs") ~= nil)
end
